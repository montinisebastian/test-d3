<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Journey Map Interactivo</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        svg { max-width: 100%; height: auto; }
        .filter-option { cursor: pointer; }
        .filter-option:hover { font-weight: bold; }
    </style>
</head>
<body>
    <div id="chart"></div>
    <script>
        // Crear el SVG
        const svg = d3.select("#chart")
            .append("svg")
            .attr("viewBox", "0 0 800 600");

        // Añadir elementos al SVG
        svg.html(`
            <defs>
                <filter id="shadow">
                    <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.3"/>
                </filter>
            </defs>
            
            <!-- Título -->
            <text x="400" y="30" font-family="Arial, sans-serif" font-size="24" text-anchor="middle" font-weight="bold">Employee Journey Map</text>
            
            <!-- Línea de tiempo -->
            <line x1="50" y1="100" x2="750" y2="100" stroke="#ccc" stroke-width="4"/>
            
            <!-- Puntos de contacto -->
            <g id="touchpoints"></g>
            
            <!-- Etiquetas de puntos de contacto -->
            <g id="touchpoint-labels" font-family="Arial, sans-serif" font-size="12" text-anchor="middle"></g>
            
            <!-- Gráfico de satisfacción -->
            <path id="satisfaction-line" fill="none" stroke="#34a853" stroke-width="3"/>
            
            <!-- Pains y Gains -->
            <g id="pains-gains" font-family="Arial, sans-serif" font-size="14"></g>
            
            <!-- Filtros -->
            <g id="filters" transform="translate(50, 400)">
                <rect width="700" height="30" fill="#f1f3f4" rx="5" ry="5"/>
                <text x="10" y="20" font-family="Arial, sans-serif" font-size="14">Filtros:</text>
            </g>
            
            <!-- Leyenda -->
            <g transform="translate(50, 450)">
                <circle cx="10" cy="10" r="5" fill="#4285f4"/>
                <text x="20" y="15" font-family="Arial, sans-serif" font-size="12">Touchpoint</text>
                <line x1="100" y1="10" x2="130" y2="10" stroke="#34a853" stroke-width="2"/>
                <text x="140" y="15" font-family="Arial, sans-serif" font-size="12">Satisfacción</text>
                <rect x="240" y="5" width="10" height="10" fill="#ea4335"/>
                <text x="255" y="15" font-family="Arial, sans-serif" font-size="12">Pain</text>
                <rect x="300" y="5" width="10" height="10" fill="#34a853"/>
                <text x="315" y="15" font-family="Arial, sans-serif" font-size="12">Gain</text>
            </g>
        `);

        // Datos simulados
        const touchpoints = [
            {name: "Reclutamiento", x: 100},
            {name: "Onboarding", x: 250},
            {name: "Desarrollo", x: 400},
            {name: "Retención", x: 550},
            {name: "Salida", x: 700}
        ];

        const satisfactionData = {
            "Todos": [250, 200, 300, 180, 220],
            "IT": [220, 240, 260, 200, 180],
            "RRHH": [280, 180, 320, 160, 240]
        };

        // Función para actualizar el gráfico
        function updateChart(area) {
            // Actualizar línea de satisfacción
            const lineGenerator = d3.line()
                .x((d, i) => touchpoints[i].x)
                .y(d => d);

            svg.select("#satisfaction-line")
                .datum(satisfactionData[area])
                .transition()
                .duration(1000)
                .attr("d", lineGenerator);

            // Actualizar pains y gains
            const painsGains = svg.select("#pains-gains").selectAll("g")
                .data(satisfactionData[area]);

            painsGains.enter()
                .append("g")
                .merge(painsGains)
                .attr("transform", (d, i) => `translate(${touchpoints[i].x}, ${d})`)
                .html((d, i) => `
                    <rect x="-20" y="${d > 250 ? -20 : 0}" width="40" height="20" 
                          fill="${d > 250 ? '#34a853' : '#ea4335'}" filter="url(#shadow)"/>
                    <text x="0" y="${d > 250 ? -5 : 15}" text-anchor="middle" fill="white">
                        ${d > 250 ? 'Gain' : 'Pain'}
                    </text>
                `);

            painsGains.exit().remove();
        }

        // Inicializar touchpoints
        svg.select("#touchpoints")
            .selectAll("circle")
            .data(touchpoints)
            .enter()
            .append("circle")
            .attr("cx", d => d.x)
            .attr("cy", 100)
            .attr("r", 10)
            .attr("fill", "#4285f4");

        // Inicializar etiquetas de touchpoints
        svg.select("#touchpoint-labels")
            .selectAll("text")
            .data(touchpoints)
            .enter()
            .append("text")
            .attr("x", d => d.x)
            .attr("y", 130)
            .text(d => d.name);

        // Añadir filtros interactivos
        const filterOptions = ["Todos", "IT", "RRHH"];
        svg.select("#filters")
            .selectAll(".filter-option")
            .data(filterOptions)
            .enter()
            .append("text")
            .attr("class", "filter-option")
            .attr("x", (d, i) => 70 + i * 60)
            .attr("y", 20)
            .text(d => d)
            .on("click", function(event, d) {
                d3.selectAll(".filter-option").attr("font-weight", "normal");
                d3.select(this).attr("font-weight", "bold");
                updateChart(d);
            });

        // Inicializar el gráfico
        updateChart("Todos");

        // Interactividad de los touchpoints
        svg.selectAll("#touchpoints circle")
            .on("mouseover", function() {
                d3.select(this).transition().duration(300).attr("r", 15);
            })
            .on("mouseout", function() {
                d3.select(this).transition().duration(300).attr("r", 10);
            });
    </script>
</body>
</html>